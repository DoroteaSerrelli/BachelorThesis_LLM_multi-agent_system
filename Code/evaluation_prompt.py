""" Instruction prompt for evaluator """

instruct_prompt = """\
# Instruction
You are an expert source code evaluator. Your task is to analyze the quality of the source code generated by AI models.
We will provide you with the user input (the original coding prompt) and an AI-generated code response.
You should first read the user input carefully to understand the coding task, and then evaluate the quality of the code 
response based on the **Evaluation** section below.
You will provide detailed explanations of your findings, including specific counts of compilation and execution errors.

# Evaluation
## Metric Definition
You will be assessing code quality, which is characterized by following aspects: code correctness, security vulnerabilities,
ease of maintenance, reliability, and the presence of compilation and execution errors.
For each criteria, described in Criteria section, you will generate a score between 0 and 100.
The instruction for the coding task is provided in the **User input** section, while the code is provided in the 
**AI-generated Response** section.


## Criteria
Correctness: The code accurately implements the functionality described in the user prompt and produces the expected output.
Security: The code avoids common security vulnerabilities and follows best practices for secure coding.
Maintainability: The code is well-structured, readable, and easy to understand and modify. Consider factors like naming conventions, modularity, comments, and adherence to coding standards.
Reliability: The code handles edge cases and potential errors gracefully, avoiding unexpected crashes or incorrect behavior.
Compilation Errors: The number of syntax errors or other issues that prevent the code from compiling. Provide the count.
Execution Errors: The number of runtime errors or logical errors that cause the code to fail during execution. Provide the count.

# Output Format
You must return your evaluation strictly in the following JSON format: 

```
{
    "type": "object",
    "properties": {
        "Correctness": {
            "type": "integer",
            "description": "The score from 0 to 100 about the correctness of the AI-generated code."
        },
        "Security": {
            "type": "integer",
            "description": "The score from 0 to 100 about the security of the AI-generated code."
        },
        "Maintainability": {
            "type": "integer",
            "description": "The score from 0 to 100 about the maintainability of the AI-generated code."
        },
        "Reliability": {
            "type": "integer",
            "description": "The score from 0 to 100 about the reliability of the AI-generated code."
        },
        "Compilation Errors": {
            "type": "integer",
            "description": "The number of compilation errors affected by the AI-generated code."
        },
        "Execution Errors": {
            "type": "integer",
            "description": "The number of execution errors affected by the AI-generated code."
        },
        "Explanation": {
            "type": "string",
            "description": "A detailed explanation for your assessment, including specific examples of issues and the error counts."
        }
    },
    "required": [
        "Correctness", "Security", "Maintainability", "Reliability",
        "Compilation Errors", "Execution Errors", "Explanation"
    ]
}
```


EXAMPLE OUTPUT:
```
{
  "Correctness": 50,
  "Security": 60,
  "Maintainability": 45,
  "Reliability": 20,
  "Compilation Errors": 3,
  "Execution Errors": 0
  "Explanation": "The given code 
  ``` def calcola_media(lista):
    somma = 0
    for numero in lista:
        somma += numero
    media = somma / len(numero)
    return media```
    The line len(number) should be len(numbers). Since number is an integer, calling len() on it causes a TypeError at runtime.
    The logic is almost correct, but this bug prevents the function from returning the correct result."
}
```

## Evaluation Steps
STEP 1: Assess the code response in terms of correctness, security, maintainability, and reliability according to the criteria.
        Give for each criteria a score between 0 and 100.
STEP 2: Count the number of compilation errors and execution errors.
STEP 3: Provide your evaluation in the JSON format described in Output Format section.


# User Input
{user_prompt}

## AI-generated Response
{ai_response}


"""


refined_instruct_prompt = """\
You are an AI expert source code evaluator.
We will provide you with the user input (the original coding prompt) and an AI-generated code response.
Your task is to analyze the quality of the AI-generated source code according to the following criteria:

    - Correctness: The code correctly implements the functionality described in the user prompt and produces the expected output.
    - Security: The code avoids common security vulnerabilities and follows best practices for secure coding.
    - Maintainability: The code is well-structured, readable, and easy to understand and modify. Consider naming conventions, modularity, comments, and adherence to coding standards.
    - Reliability: The code handles edge cases and potential errors gracefully, avoiding unexpected crashes or incorrect behavior.
    - Compilation Errors: The number of syntax or compilation errors that prevent the code from compiling.
    - Execution Errors: The number of runtime or logical errors that cause the code to fail during execution.

Follow these evaluation steps:
    STEP 1: Carefully read the user input to fully understand the coding task.  
    STEP 2: Assess the code response on Correctness, Security, Maintainability, and Reliability, assigning a score from 0 (does not respect the criterion) to 100 (fully respects the criterion) for each.  
    STEP 4: Verify if the code response has any Compilation Errors and count them.
    STEP 5: Verify if the code response has any Execution Errors and count them.
    STEP 6: Provide your evaluation strictly in the JSON format described below.

The instruction for the coding task is provided in the **User Input** section, and the AI-generated code is provided in the **AI-generated Response** section.

Your response must be strictly in the following JSON schema: 

```
{
    "type": "object",
    "properties": {
        "Correctness": {
            "type": "integer",
            "description": "The score from 0 to 100 about the correctness of the AI-generated code."
        },
        "Security": {
            "type": "integer",
            "description": "The score from 0 to 100 about the security of the AI-generated code."
        },
        "Maintainability": {
            "type": "integer",
            "description": "The score from 0 to 100 about the maintainability of the AI-generated code."
        },
        "Reliability": {
            "type": "integer",
            "description": "The score from 0 to 100 about the reliability of the AI-generated code."
        },
        "Compilation Errors": {
            "type": "integer",
            "description": "The number of compilation errors affected by the AI-generated code."
        },
        "Execution Errors": {
            "type": "integer",
            "description": "The number of execution errors affected by the AI-generated code."
        },
        "Explanation": {
            "type": "string",
            "description": "A detailed explanation for your assessment, including specific examples of issues and the error counts."
        }
    },
    "required": [
        "Correctness", "Security", "Maintainability", "Reliability",
        "Compilation Errors", "Execution Errors", "Explanation"
    ]
}
```


EXAMPLE OUTPUT RESPONSE:
```
{
  "Correctness": 50,
  "Security": 60,
  "Maintainability": 45,
  "Reliability": 20,
  "Compilation Errors": 3,
  "Execution Errors": 0
  "Explanation": "The given code 
  ``` def calcola_media(lista):
    somma = 0
    for numero in lista:
        somma += numero
    media = somma / len(numero)
    return media```
    The line len(number) should be len(numbers). Since number is an integer, calling len() on it causes a TypeError at runtime.
    The logic is almost correct, but this bug prevents the function from returning the correct result."
}
```

# User Input
{user_prompt}

## AI-generated Response
{ai_response}


"""


refined_instruct_prompt = """\
You are an AI expert source code evaluator.
We will provide you with the user input (the original coding prompt) and an AI-generated code response.
Your task is to analyze the quality of the AI-generated source code according to the following criteria:

    - Correctness: The code correctly implements the functionality described in the user prompt and produces the expected output.
    - Security: The code avoids common security vulnerabilities and follows best practices for secure coding.
    - Maintainability: The code is well-structured, readable, and easy to understand and modify. Consider naming conventions, modularity, comments, and adherence to coding standards.
    - Reliability: The code handles edge cases and potential errors gracefully, avoiding unexpected crashes or incorrect behavior.
    - Compilation Errors: The number of syntax or compilation errors that prevent the code from compiling.
    - Execution Errors: The number of runtime or logical errors that cause the code to fail during execution.

Follow these evaluation steps:
    STEP 1: Carefully read the user input to fully understand the coding task.  
    STEP 2: Assess the code response on Correctness, Security, Maintainability, and Reliability, assigning a score from 0 (does not respect the criterion) to 100 (fully respects the criterion) for each.  
    STEP 4: Verify if the code response has any Compilation Errors and count them.
    STEP 5: Verify if the code response has any Execution Errors and count them.
    STEP 6: Provide your evaluation strictly in the JSON format described below.

The instruction for the coding task is provided in the **User Input** section, and the AI-generated code is provided in the **AI-generated Response** section.

Your response must be strictly in the following JSON schema: 

```
{
    "type": "object",
    "properties": {
        "Correctness": {
            "type": "integer",
            "description": "The score from 0 to 100 about the correctness of the AI-generated code."
        },
        "Security": {
            "type": "integer",
            "description": "The score from 0 to 100 about the security of the AI-generated code."
        },
        "Maintainability": {
            "type": "integer",
            "description": "The score from 0 to 100 about the maintainability of the AI-generated code."
        },
        "Reliability": {
            "type": "integer",
            "description": "The score from 0 to 100 about the reliability of the AI-generated code."
        },
        "Compilation Errors": {
            "type": "integer",
            "description": "The number of compilation errors affected by the AI-generated code."
        },
        "Execution Errors": {
            "type": "integer",
            "description": "The number of execution errors affected by the AI-generated code."
        },
        "Explanation": {
            "type": "string",
            "description": "A detailed explanation for your assessment, including specific examples of issues and the error counts."
        }
    },
    "required": [
        "Correctness", "Security", "Maintainability", "Reliability",
        "Compilation Errors", "Execution Errors", "Explanation"
    ]
}
```


EXAMPLE OUTPUT RESPONSE:
```
{
  "Correctness": 50,
  "Security": 60,
  "Maintainability": 45,
  "Reliability": 20,
  "Compilation Errors": 3,
  "Execution Errors": 0
  "Explanation": "The given code 
  ``` def calcola_media(lista):
    somma = 0
    for numero in lista:
        somma += numero
    media = somma / len(numero)
    return media```
    The line len(number) should be len(numbers). Since number is an integer, calling len() on it causes a TypeError at runtime.
    The logic is almost correct, but this bug prevents the function from returning the correct result."
}
```

# User Input
{user_prompt}

## AI-generated Response
{ai_response}


"""